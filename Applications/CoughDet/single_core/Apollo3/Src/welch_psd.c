/*
 *  Copyright (c) [2024] [Embedded Systems Laboratory (ESL), EPFL]
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */


//////////////////////////////////////////////////////
// Author:          Stefano Albini                  //
// Contributions:   Dimitrios Samakovlis            //
// Date:            September 2023                  //
//////////////////////////////////////////////////////



#include "welch_psd.h"

const float hann_window[NPERSEG] = {
0.0,
1.2184647302626583e-05,
4.873799534788059e-05,
0.0001096582625772502,
0.00019494247982282387,
0.00030458649045211894,
0.0004385849505708084,
0.0005969313292830125,
0.000779617909009489,
0.0009866357858642205,
0.0012179748700879012,
0.0014736238865398765,
0.001753570375247815,
0.002057800692014833,
0.0023863000090844078,
0.002739052315863355,
0.0031160404197018154,
0.0035172459467315287,
0.0039426493427611176,
0.004392229874229159,
0.0048659656292148745,
0.005363833518505889,
0.005885809276723608,
0.006431867463506047,
0.007001981464747564,
0.00759612349389599,
0.008214264593307041,
0.00885637463565564,
0.009522422325404234,
0.010212375200327972,
0.010926199633097156,
0.01166386083291604,
0.012425322847218367,
0.013210548563419855,
0.014019499710726857,
0.014852136862001764,
0.015708419435684462,
0.01658830569777031,
0.017491752763844293,
0.018418716601170948,
0.019369152030840553,
0.020343012729971244,
0.02134025123396638,
0.022360818938828186,
0.02340466610352654,
0.024471741852423234,
0.025561994177751735,
0.02667536994215186,
0.0278118148812595,
0.028971273606351655,
0.03015368960704584,
0.03135900525405427,
0.03258716180199278,
0.033838099392243914,
0.035111757055874326,
0.03640807271660634,
0.03772698319384349,
0.0390684242057498,
0.04043233037238281,
0.04181863521888024,
0.04322727117869962,
0.04465816959691149,
0.04611126073354571,
0.04758647376699032,
0.049083736797443156,
0.05060297685041659,
0.05214411988029366,
0.053707090773937316,
0.05529181335435124,
0.056898210384392744,
0.058526203570536506,
0.060175713566691824,
0.06184665997806821,
0.06353896136509524,
0.0652525352473905,
0.06698729810778076,
0.06874316539637126,
0.07052005153466778,
0.0723178699197467,
0.07413653292847616,
0.07597595192178702,
0.07783603724899246,
0.07971669825215788,
0.08161784327051919,
0.08353937964495028,
0.08548121372247919,
0.08744325086085247,
0.08942539543314798,
0.09142755083243576,
0.09344961947648622,
0.09549150281252633,
0.09755310132204298,
0.09963431452563332,
0.10173504098790187,
0.1038551783224047,
0.10599462319663905,
0.10815327133708014,
0.110331017534263,
0.11252775564791023,
0.11474337861210543,
0.11697777844051105,
0.11923084623163172,
0.12150247217412186,
0.12379254555213787,
0.12610095475073413,
0.128427587261303,
0.1307723296870582,
0.13313506774856187,
0.13551568628929433,
0.13791406928126637,
0.14033009983067452,
0.14276366018359826,
0.14521463173173965,
0.14768289501820264,
0.1501683297433174,
0.15267081477050132,
0.1551902281321652,
0.15772644703565564,
0.16027934786924186,
0.1628488062081383,
0.16543469682057105,
0.1680368936738792,
0.17065526994065988,
0.17328969800494726,
0.17594004946843456,
0.17860619515673032,
0.18128800512565513,
0.18398534866757454,
0.18669809431776974,
0.18942610986084485,
0.19216926233717085,
0.1949274180493662,
0.19770044256881258,
0.20048820074220713,
0.20329055669814933,
0.2061073738537635,
0.20893851492135534,
0.2117838419151034,
0.2146432161577842,
0.21751649828753106,
0.22040354826462666,
0.223304225378328,
0.22621838825372492,
0.22914589485863013,
0.23208660251050178,
0.2350403678833976,
0.2380070470149605,
0.24098649531343497,
0.2439785675647143,
0.24698311793941818,
0.2500000000000001,
0.2530290667078846,
0.25607017043063357,
0.2591231629491425,
0.2621878954648623,
0.26526421860705474,
0.2683519824400691,
0.27145103647065305,
0.27456122965528457,
0.2776824104075364,
0.28081442660546124,
0.283957125599009,
0.28711035421746367,
0.29027395877691164,
0.2934477850877292,
0.2966316784621,
0.2998254837215526,
0.3030290452045245,
0.3062422067739486,
0.3094648118248631,
0.3126967032920441,
0.31593772365766115,
0.3191877149589539,
0.32244651879593156,
0.3257139763390925,
0.32898992833716567,
0.33227421512487254,
0.3355666766307084,
0.3388671523847445,
0.34217548152644883,
0.34549150281252633,
0.3488150546247778,
0.35214597497797673,
0.3554841015277642,
0.3588292715785618,
0.36218132209150045,
0.3655400896923672,
0.3689054106795677,
0.3722771210321048,
0.3756550564175727,
0.3790390522001662,
0.3824289434487051,
0.3858245649446722,
0.3892257511902665,
0.3926323364164685,
0.3960441545911204,
0.39946103942701777,
0.4028828243900141,
0.4063093427071377,
0.40974042737472005,
0.41317591116653485,
0.4166156266419489,
0.4200594061540826,
0.423507081857981,
0.42695848571879425,
0.4304134495199673,
0.43387180487143884,
0.4373333832178479,
0.4407980158467496,
0.4442655338968373,
0.44773576836617335,
0.4512085501204253,
0.45468370990111,
0.45816107833384234,
0.4616404859365908,
0.46512176312793746,
0.46860474023534343,
0.4720892475034182,
0.47557511510219347,
0.4790621731354003,
0.48255025164874965,
0.48603918063821566,
0.48952879005832156,
0.4930189098304274,
0.49650936985101923,
0.5,
0.5034906301489808,
0.5069810901695727,
0.5104712099416785,
0.5139608193617845,
0.5174497483512506,
0.5209378268645999,
0.5244248848978067,
0.5279107524965819,
0.5313952597646567,
0.5348782368720627,
0.5383595140634094,
0.5418389216661579,
0.5453162900988902,
0.5487914498795748,
0.5522642316338269,
0.5557344661031628,
0.5592019841532506,
0.5626666167821522,
0.5661281951285614,
0.5695865504800327,
0.5730415142812059,
0.5764929181420191,
0.5799405938459175,
0.5833843733580512,
0.5868240888334653,
0.5902595726252801,
0.5936906572928624,
0.597117175609986,
0.6005389605729824,
0.6039558454088797,
0.6073676635835317,
0.6107742488097337,
0.6141754350553279,
0.6175710565512951,
0.6209609477998339,
0.6243449435824275,
0.6277228789678954,
0.6310945893204325,
0.6344599103076329,
0.6378186779084997,
0.6411707284214383,
0.6445158984722359,
0.6478540250220234,
0.6511849453752223,
0.6545084971874737,
0.6578245184735513,
0.6611328476152556,
0.6644333233692916,
0.6677257848751276,
0.6710100716628344,
0.6742860236609076,
0.6775534812040686,
0.6808122850410462,
0.6840622763423391,
0.6873032967079561,
0.6905351881751371,
0.6937577932260516,
0.6969709547954757,
0.7001745162784476,
0.7033683215379002,
0.7065522149122709,
0.7097260412230887,
0.7128896457825364,
0.7160428744009912,
0.7191855733945388,
0.7223175895924638,
0.7254387703447155,
0.7285489635293472,
0.731648017559931,
0.7347357813929455,
0.7378121045351378,
0.7408768370508578,
0.7439298295693665,
0.7469709332921156,
0.7500000000000002,
0.753016882060582,
0.7560214324352859,
0.7590135046865651,
0.7619929529850396,
0.7649596321166025,
0.7679133974894983,
0.77085410514137,
0.7737816117462751,
0.776695774621672,
0.7795964517353734,
0.7824835017124689,
0.7853567838422159,
0.7882161580848966,
0.7910614850786447,
0.7938926261462366,
0.7967094433018507,
0.7995117992577929,
0.8022995574311875,
0.8050725819506339,
0.8078307376628291,
0.8105738901391553,
0.8133019056822304,
0.8160146513324255,
0.8187119948743449,
0.8213938048432697,
0.8240599505315656,
0.8267103019950528,
0.8293447300593403,
0.8319631063261208,
0.8345653031794291,
0.8371511937918618,
0.8397206521307583,
0.8422735529643444,
0.8448097718678349,
0.8473291852294987,
0.8498316702566828,
0.8523171049817975,
0.8547853682682606,
0.8572363398164018,
0.8596699001693257,
0.8620859307187339,
0.8644843137107059,
0.8668649322514383,
0.869227670312942,
0.8715724127386972,
0.8738990452492661,
0.8762074544478623,
0.8784975278258783,
0.8807691537683685,
0.883022221559489,
0.8852566213878945,
0.8874722443520897,
0.8896689824657371,
0.8918467286629199,
0.8940053768033609,
0.8961448216775953,
0.8982649590120981,
0.9003656854743667,
0.902446898677957,
0.9045084971874737,
0.9065503805235138,
0.9085724491675642,
0.910574604566852,
0.9125567491391475,
0.9145187862775208,
0.9164606203550498,
0.9183821567294809,
0.9202833017478422,
0.9221639627510076,
0.924024048078213,
0.9258634670715238,
0.9276821300802534,
0.9294799484653322,
0.9312568346036287,
0.9330127018922194,
0.9347474647526095,
0.9364610386349048,
0.9381533400219318,
0.9398242864333083,
0.9414737964294635,
0.9431017896156074,
0.9447081866456488,
0.9462929092260628,
0.9478558801197066,
0.9493970231495836,
0.950916263202557,
0.9524135262330098,
0.9538887392664543,
0.9553418304030886,
0.9567727288213005,
0.9581813647811199,
0.9595676696276173,
0.9609315757942503,
0.9622730168061566,
0.9635919272833937,
0.9648882429441257,
0.9661619006077561,
0.9674128381980072,
0.9686409947459458,
0.9698463103929542,
0.9710287263936483,
0.9721881851187405,
0.9733246300578482,
0.9744380058222483,
0.9755282581475768,
0.9765953338964735,
0.9776391810611718,
0.9786597487660336,
0.9796569872700287,
0.9806308479691594,
0.9815812833988291,
0.9825082472361557,
0.9834116943022297,
0.9842915805643155,
0.9851478631379982,
0.9859805002892732,
0.9867894514365801,
0.9875746771527816,
0.988336139167084,
0.9890738003669028,
0.989787624799672,
0.9904775776745958,
0.9911436253643444,
0.991785735406693,
0.9924038765061041,
0.9929980185352525,
0.993568132536494,
0.9941141907232764,
0.9946361664814942,
0.9951340343707852,
0.9956077701257708,
0.996057350657239,
0.9964827540532685,
0.9968839595802982,
0.9972609476841368,
0.9976136999909155,
0.9979421993079852,
0.9982464296247522,
0.9985263761134602,
0.9987820251299122,
0.9990133642141358,
0.9992203820909905,
0.999403068670717,
0.9995614150494292,
0.9996954135095479,
0.9998050575201771,
0.9998903417374227,
0.9999512620046521,
0.9999878153526973,
1.0,
0.9999878153526973,
0.9999512620046521,
0.9998903417374227,
0.9998050575201771,
0.9996954135095479,
0.9995614150494292,
0.999403068670717,
0.9992203820909905,
0.9990133642141358,
0.9987820251299121,
0.9985263761134602,
0.9982464296247522,
0.9979421993079851,
0.9976136999909155,
0.9972609476841366,
0.9968839595802982,
0.9964827540532685,
0.9960573506572389,
0.9956077701257708,
0.9951340343707851,
0.9946361664814942,
0.9941141907232764,
0.993568132536494,
0.9929980185352525,
0.9924038765061041,
0.9917857354066929,
0.9911436253643443,
0.9904775776745958,
0.989787624799672,
0.9890738003669028,
0.988336139167084,
0.9875746771527816,
0.98678945143658,
0.9859805002892731,
0.9851478631379982,
0.9842915805643155,
0.9834116943022296,
0.9825082472361557,
0.9815812833988291,
0.9806308479691594,
0.9796569872700287,
0.9786597487660336,
0.9776391810611718,
0.9765953338964735,
0.9755282581475768,
0.9744380058222483,
0.9733246300578482,
0.9721881851187405,
0.9710287263936483,
0.9698463103929542,
0.9686409947459458,
0.9674128381980072,
0.9661619006077561,
0.9648882429441257,
0.9635919272833937,
0.9622730168061566,
0.9609315757942503,
0.9595676696276172,
0.9581813647811197,
0.9567727288213004,
0.9553418304030885,
0.9538887392664543,
0.9524135262330098,
0.9509162632025568,
0.9493970231495834,
0.9478558801197063,
0.9462929092260627,
0.9447081866456487,
0.9431017896156073,
0.9414737964294635,
0.9398242864333082,
0.9381533400219317,
0.9364610386349048,
0.9347474647526095,
0.9330127018922192,
0.9312568346036287,
0.9294799484653321,
0.9276821300802532,
0.9258634670715238,
0.9240240480782129,
0.9221639627510074,
0.920283301747842,
0.9183821567294808,
0.9164606203550496,
0.9145187862775208,
0.9125567491391475,
0.910574604566852,
0.9085724491675642,
0.9065503805235138,
0.9045084971874737,
0.902446898677957,
0.9003656854743667,
0.8982649590120981,
0.8961448216775953,
0.8940053768033609,
0.8918467286629199,
0.8896689824657371,
0.8874722443520897,
0.8852566213878945,
0.883022221559489,
0.8807691537683684,
0.8784975278258782,
0.8762074544478622,
0.8738990452492659,
0.871572412738697,
0.8692276703129418,
0.8668649322514381,
0.8644843137107057,
0.8620859307187336,
0.8596699001693255,
0.8572363398164016,
0.8547853682682605,
0.8523171049817972,
0.8498316702566826,
0.8473291852294986,
0.8448097718678348,
0.8422735529643443,
0.8397206521307582,
0.8371511937918616,
0.834565303179429,
0.8319631063261207,
0.8293447300593402,
0.8267103019950528,
0.8240599505315653,
0.8213938048432697,
0.8187119948743447,
0.8160146513324255,
0.8133019056822302,
0.8105738901391553,
0.807830737662829,
0.8050725819506339,
0.8022995574311873,
0.7995117992577929,
0.7967094433018506,
0.7938926261462366,
0.7910614850786446,
0.7882161580848966,
0.7853567838422157,
0.7824835017124689,
0.7795964517353733,
0.776695774621672,
0.7737816117462749,
0.77085410514137,
0.767913397489498,
0.7649596321166025,
0.7619929529850393,
0.7590135046865651,
0.7560214324352855,
0.7530168820605818,
0.7499999999999998,
0.7469709332921155,
0.7439298295693662,
0.7408768370508576,
0.7378121045351373,
0.7347357813929454,
0.731648017559931,
0.728548963529347,
0.7254387703447155,
0.7223175895924636,
0.7191855733945388,
0.716042874400991,
0.7128896457825364,
0.7097260412230885,
0.7065522149122709,
0.7033683215379,
0.7001745162784476,
0.6969709547954754,
0.6937577932260516,
0.6905351881751369,
0.6873032967079561,
0.6840622763423388,
0.6808122850410462,
0.6775534812040684,
0.6742860236609076,
0.6710100716628342,
0.6677257848751276,
0.6644333233692914,
0.6611328476152556,
0.6578245184735511,
0.6545084971874737,
0.6511849453752221,
0.6478540250220234,
0.6445158984722356,
0.6411707284214383,
0.6378186779084993,
0.6344599103076328,
0.6310945893204322,
0.6277228789678952,
0.6243449435824272,
0.6209609477998338,
0.6175710565512947,
0.6141754350553279,
0.6107742488097334,
0.6073676635835316,
0.6039558454088794,
0.6005389605729823,
0.5971171756099857,
0.5936906572928623,
0.5902595726252797,
0.5868240888334652,
0.5833843733580508,
0.5799405938459173,
0.5764929181420192,
0.5730415142812058,
0.5695865504800328,
0.5661281951285612,
0.5626666167821522,
0.5592019841532504,
0.5557344661031628,
0.5522642316338267,
0.5487914498795748,
0.5453162900988899,
0.5418389216661579,
0.5383595140634092,
0.5348782368720627,
0.5313952597646565,
0.5279107524965819,
0.5244248848978065,
0.5209378268645999,
0.5174497483512503,
0.5139608193617845,
0.5104712099416783,
0.5069810901695727,
0.5034906301489805,
0.5,
0.496509369851019,
0.4930189098304274,
0.48952879005832134,
0.48603918063821555,
0.4825502516487493,
0.47906217313540017,
0.47557511510219314,
0.4720892475034181,
0.4686047402353431,
0.46512176312793735,
0.46164048593659046,
0.45816107833384223,
0.4546837099011097,
0.4512085501204252,
0.447735768366173,
0.4442655338968372,
0.44079801584674927,
0.4373333832178478,
0.4338718048714385,
0.4304134495199672,
0.4269584857187939,
0.4235070818579809,
0.42005940615408227,
0.4166156266419488,
0.41317591116653496,
0.40974042737471994,
0.4063093427071378,
0.4028828243900139,
0.39946103942701777,
0.3960441545911202,
0.3926323364164685,
0.38922575119026626,
0.3858245649446722,
0.38242894344870487,
0.3790390522001662,
0.37565505641757246,
0.3722771210321048,
0.3689054106795675,
0.3655400896923672,
0.3621813220915002,
0.3588292715785618,
0.35548410152776405,
0.35214597497797673,
0.3488150546247776,
0.34549150281252633,
0.3421754815264486,
0.3388671523847445,
0.33556667663070816,
0.33227421512487254,
0.32898992833716545,
0.3257139763390924,
0.3224465187959313,
0.3191877149589538,
0.3159377236576608,
0.31269670329204396,
0.30946481182486274,
0.30624220677394853,
0.30302904520452423,
0.2998254837215525,
0.2966316784620997,
0.29344778508772906,
0.2902739587769112,
0.28711035421746367,
0.2839571255990086,
0.28081442660546124,
0.277682410407536,
0.27456122965528457,
0.27145103647065266,
0.2683519824400691,
0.26526421860705474,
0.2621878954648623,
0.2591231629491425,
0.25607017043063357,
0.2530290667078846,
0.2499999999999999,
0.24698311793941818,
0.24397856756471414,
0.24098649531343497,
0.23800704701496034,
0.2350403678833976,
0.23208660251050156,
0.22914589485863013,
0.22621838825372476,
0.223304225378328,
0.22040354826462644,
0.21751649828753106,
0.21464321615778403,
0.2117838419151034,
0.20893851492135518,
0.2061073738537635,
0.20329055669814916,
0.20048820074220713,
0.19770044256881242,
0.1949274180493662,
0.1921692623371707,
0.18942610986084485,
0.18669809431776957,
0.18398534866757454,
0.18128800512565496,
0.17860619515673032,
0.1759400494684344,
0.17328969800494726,
0.17065526994065955,
0.1680368936738792,
0.16543469682057071,
0.1628488062081383,
0.16027934786924153,
0.15772644703565564,
0.15519022813216493,
0.15267081477050132,
0.15016832974331712,
0.14768289501820264,
0.14521463173173932,
0.14276366018359826,
0.14033009983067424,
0.1379140692812662,
0.13551568628929433,
0.13313506774856176,
0.1307723296870582,
0.12842758726130282,
0.12610095475073413,
0.12379254555213776,
0.12150247217412186,
0.11923084623163155,
0.11697777844051105,
0.11474337861210532,
0.11252775564791023,
0.11033101753426283,
0.10815327133708014,
0.10599462319663894,
0.1038551783224047,
0.10173504098790176,
0.09963431452563332,
0.09755310132204281,
0.09549150281252633,
0.09344961947648606,
0.09142755083243576,
0.08942539543314787,
0.08744325086085247,
0.08548121372247902,
0.08353937964495028,
0.08161784327051907,
0.07971669825215788,
0.07783603724899235,
0.07597595192178702,
0.07413653292847605,
0.0723178699197467,
0.07052005153466767,
0.06874316539637126,
0.06698729810778054,
0.0652525352473905,
0.06353896136509501,
0.06184665997806821,
0.0601757135666916,
0.058526203570536506,
0.05689821038439252,
0.05529181335435124,
0.05370709077393715,
0.05214411988029355,
0.05060297685041637,
0.0490837367974431,
0.0475864737669901,
0.046111260733545656,
0.04465816959691149,
0.04322727117869951,
0.04181863521888024,
0.04043233037238275,
0.0390684242057498,
0.03772698319384338,
0.03640807271660634,
0.03511175705587427,
0.033838099392243914,
0.032587161801992726,
0.03135900525405427,
0.030153689607045786,
0.028971273606351655,
0.027811814881259445,
0.02667536994215186,
0.02556199417775168,
0.024471741852423234,
0.023404666103526428,
0.022360818938828186,
0.021340251233966323,
0.020343012729971244,
0.019369152030840497,
0.018418716601170948,
0.017491752763844237,
0.01658830569777031,
0.015708419435684406,
0.014852136862001764,
0.014019499710726802,
0.013210548563419855,
0.012425322847218312,
0.01166386083291604,
0.010926199633097156,
0.010212375200327972,
0.009522422325404178,
0.00885637463565564,
0.008214264593306986,
0.00759612349389599,
0.007001981464747509,
0.006431867463506047,
0.005885809276723553,
0.005363833518505834,
0.004865965629214819,
0.004392229874229103,
0.003942649342761062,
0.0035172459467315287,
0.00311604041970176,
0.0027390523158632996,
0.0023863000090844078,
0.002057800692014833,
0.001753570375247815,
0.0014736238865398765,
0.0012179748700879012,
0.0009866357858642205,
0.000779617909009489,
0.000596931329282957,
0.0004385849505708084,
0.00030458649045211894,
0.00019494247982282387,
0.0001096582625772502,
4.873799534788059e-05,
1.2184647302626583e-05
};
